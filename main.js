(()=>{"use strict";const e=document.forms["edit-profile"],t=document.querySelector(".popup__input_type_name"),s=document.querySelector(".popup__input_type_job"),r=document.forms["add-card"],n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};class o{constructor(e,t,s,r){this._link=e,this._name=t,this._templateSelector=s,this._handleCardClick=r}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".place-card").cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._cardHeading=this._element.querySelector(".place-card__heading"),this._cardImage=this._element.querySelector(".place-card__image"),this._cardHeading.textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=this._name,this._setEventListeners(),this._element}_setEventListeners(){this._like=this._element.querySelector(".place-card__like"),this._like.addEventListener("click",(()=>this._setLike())),this._removeIcon=this._element.querySelector(".place-card__remove-icon"),this._removeIcon.addEventListener("click",(()=>this._removeCard())),this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._link,this._name)}))}_setLike(){this._like.classList.toggle("place-card__like_active")}_removeCard(){this._element.remove(),this._element=null}}class i{constructor(e,t){this._config=e,this._formElement=t,this._submitButton=this._formElement.querySelector(this._config.submitButtonSelector),this._inputs=Array.from(this._formElement.querySelectorAll(this._config.inputSelector))}enableValidation(){this._setFormListener()}_setFormListener(){this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._handleInputValidation(e),this._toggleButtonState()}))})),this._toggleButtonState()}_toggleButtonState(){this._formElement.checkValidity()?(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._config.inactiveButtonClass)):(this._submitButton.disabled=!0,this._submitButton.classList.add(this._config.inactiveButtonClass))}_handleInputValidation(e){e.validity.valid?this._hideError(e):this._showError(e)}_showError(e){this._errorElement=this._formElement.querySelector(`.${e.id}-error`),this._errorElement.classList.add(this._config.errorClass),e.classList.add(this._config.inputErrorClass),this._errorElement.textContent=e.validationMessage}_hideError(e){this._errorElement=this._formElement.querySelector(`.${e.id}-error`),this._errorElement.classList.remove(this._config.errorClass),e.classList.remove(this._config.inputErrorClass),this._errorElement.textContent=""}resetInputError(){this._inputs.forEach((e=>this._hideError(e))),this._toggleButtonState()}}class a{constructor(e){this._popup=document.querySelector(e),this._closeIcon=this._popup.querySelector(".popup__close-icon"),this._handleEscapeClose=this._handleEscapeClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscapeClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscapeClose)}setEventListeners(){this._closeIcon.addEventListener("click",(()=>this.close())),this._popup.addEventListener("mousedown",(e=>this._handleClickByOverlay(e)))}_handleEscapeClose(e){"Escape"===e.key&&this.close()}_handleClickByOverlay(e){e.target===this._popup&&this.close()}}class l extends a{constructor({popupSelector:e,formSubmitHandler:t}){super(e),this.formSubmitHandler=t,this._inputs=this._popup.querySelectorAll(".popup__input"),this._form=this._popup.querySelector(".popup__form")}_getInputValues(){return this._inputValues={},this._inputs.forEach((e=>{this._inputValues[e.name]=e.value})),this._inputValues}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this.formSubmitHandler(this._getInputValues())})),super.setEventListeners()}close(){this._form.reset(),super.close()}}const p=new i(n,e),c=new i(n,r),_=new class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}addItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>this._renderer(e)))}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>_.addItem(f(e.link,e.name))},".places"),u=new class extends a{constructor({popupSelector:e}){super(e),this._popupImage=this._popup.querySelector(".popup__fullsize-image"),this._popupCaption=this._popup.querySelector(".popup__subheading")}open({link:e,name:t}){this._popupImage.src=e,this._popupImage.alt=t,this._popupCaption.textContent=t,super.open()}}({popupSelector:".popup_type_image"}),d=new l({popupSelector:".popup_type_profile",formSubmitHandler:function(e){m.setUserInfo({name:e["user-name"],job:e["user-job"]}),d.close()}}),h=new l({popupSelector:".popup_type_card-adding",formSubmitHandler:function(e){const t={};t.name=e["place-name"],t.link=e["picture-link"],_.addItem(f(t.link,t.name)),h.close()}}),m=new class{constructor({userNameSelector:e,userJobSelector:t}){this._userNameSelector=e,this._userJobSelector=t,this._name=document.querySelector(this._userNameSelector),this._job=document.querySelector(this._userJobSelector)}getUserInfo(){return this._userData={},this._userData.name=this._name.textContent,this._userData.job=this._job.textContent,this._userData}setUserInfo({name:e,job:t}){this._name.textContent=e,this._job.textContent=t}}({userNameSelector:".profile__heading",userJobSelector:".profile__subheading"});function f(e,t){const s=new o(e,t,".place-card-template",(()=>{!function({link:e,name:t}){u.open({link:e,name:t})}({link:e,name:t})}));return s.generateCard()}_.renderItems(),u.setEventListeners(),d.setEventListeners(),h.setEventListeners(),p.enableValidation(),c.enableValidation(),document.querySelector(".edit-button").addEventListener("click",(()=>{t.value=m.getUserInfo().name,s.value=m.getUserInfo().job,p.resetInputError(),d.open()})),document.querySelector(".add-card-button").addEventListener("click",(()=>{c.resetInputError(),h.open()}))})();